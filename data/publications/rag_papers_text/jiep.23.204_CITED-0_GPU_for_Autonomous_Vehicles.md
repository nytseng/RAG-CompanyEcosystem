特集／CASE を支える ECU・信頼性・EMC 設計技術

自動運転分野におけるGPUの活用

室河　徹 *

GPU for Autonomous Vehicles

Tohru MUROKAWA*

エヌビディア合同会社（〒 107-0052　東京都港区赤坂 2-11-7　ATT 新館 13 階）

NVIDIA G.K (ATT New Tower, 13th Floor, 2-11-7 Akasaka, Minato-ku, Tokyo 107-0052)

1. はじめに

点演算コアを内蔵し並列処理性能を高める方向で進化した。

2006 年に CUDA (Compute Unified Device Architecture) と

GPU (Graphics Processing Unit) は一般消費者向けのコン

いうコンピューティング向けのプログラミングモデル・開

ピュータゲームだけではなく，プロフェッショナル向けビ

発環境が発表され，GPU の高い並列演算性能を汎用コン

ジュアルコンピューティングや，科学者や研究者向けのハ

ピューティングにも使用できるようになった。2007 年に発

イパフォーマンスコンピューティング向けに利用され発展

表された Tesla S1070 GPU を 170 基搭載した世界初の GPU

してきた。近年のディープラーニングの発展により，デー

スーパーコンピュータである東京工業大学の TSUBAME1.2

タセンターや，医療分野，産業機器，組み込み機器，通信

は，2008 年 11 月のスーパーコンピュータの TOP500 ラン

など応用分野が増えてきている。本稿では，GPU の活用が

キングで 29 位に入り注目を集めた。その後もスーパーコン

進む自動運転分野について解説する。

ピュータへの GPU の採用が増え続けており，2019 年 11 月

2. GPU コンピューティング

に発表された TOP500（表 1）では，上位 10 システムの半

数を含む 136 のシステムにNVIDIA GPUが採用されている。

GPU は，コンピュータで三次元 (3D) グラフィックの描

TOP5 で 4 期連続 1 位を獲得しているアメリカオークリッ

画を高速化する目的で開発された。3D グラフィックスで

ジ国立研究所の Summit は，9,216 基の IBM Power9 CPU と

は，オブジェクトを多数の三角形ポリゴンの集合でモデリ

27,648 基の NVIDIA V100 GPU で構成され，200 ペタ FLOPS，

ングする。オブジェクトは 3D 空間内で自由に姿勢を変え，

つまり 1 秒間に 20 京回の浮動小数点演算を行うことができ

移動し，光を反射し，影を作る。またそれを見る視点・カ

る。ゲノム解析，気象学，病理学，核廃棄物浄化など，エ

メラの位置も自由に変えることができる。1999 年発表され

クサスケールの科学アプリケーションで使用されている。

たNVIDIA GeForce 256 では，座標変換と光源処理をハード

日本国内では，国立研究開発法人産業技術総合研究所の

ウェア化し，初めて GPU という名前が与えられた。2001

ABCI が 8 位 に 入 っ て い る。ABCI は，1,088 基 の Intel

年に発表された GeForce 3 では，頂点シェーダやピクセル

Xenon2 基と 4,352 基の NVIDIA V100 GPU で構成され，人

シェーダのプログラムが可能になった。シェーダで処理す

工知能処理向け計算インフラストラクチャとして運用され

るデータは並列処理に向いており，GPU は多くの浮動小数

ている。外部からの利用にも解放されている。NVIDIA 社

表 1.　TOP100 の上位 10 リスト

Rank

1

Rmax (PFlop/s) 149

Name (Country)

Summit (US)

Processor

IBM POWER9 22C 3.07 GHz

Accelerator

NVIDIA Volta GV100

2

95

Sierra (US)

IBM POWER9 22C 3.1 GHz

NVIDIA Volta GV100

3

93

Sunway TaihuLight (China) Sunway SW26010 260C 1.45 GHz None

4

61

Tianhe-2A (China)

Intel Xeon E5-2692v2 12C 2.2 GHz Matrix-2000

5

24

Frontera (US)

Xeon Platinum 8280 28C 2.7 GHz

None

6

21

Piz Daint (Switzerland)

Xeon E5-2690v3 12C 2.6 GHz

NVIDIA Tesla P100

7

20

Trinity (US)

Intel Xeon Phi 7250 68C 1.4 GHz

None

8

20

ABCI (Japan)

Xeon Gold 6148 20C 2.4 GHz

NVIDIA Tesla V100 SXM2

9

19

SuperMUC-NG (Germany) Xeon Platinum 8174 24C 3.1 GHz

None

10

18

Lassen (US)

IBM POWER9 22C 3.1 GHz

NVIDIA Tesla V100

20

9

NVIDIA DGX SuperPOD (US)

Xeon Platinum 8174 24C 3.1 GHz

NVIDIA Tesla V100

204

エレクトロニクス実装学会誌　Vol. 23 No. 3 (2020)

Copyright© The Japan Institute of Electronics Packaging

図 2.　GV100 ブロック図

図 1.　NVIDIA DGX SuperPOD

内に設置されている 3 システムも TOP500 にランクインし

ており，20 位の DGX SuperPOD（図 1）は自動運転車向け

の AI 開発に使用されている。

2.1	 GPU の内部構造

ここで科学技術計算や解析，シミュレーション，ディー

プラーニングなどに使用される GV100 GPU について紹介

する。GV100 には，5,120 個の CUDA コアと呼ばれる演算

ユニット，640 個の Tensor コアと呼ばれる行列演算ユニッ

図 3.　Tensor コア

トが内蔵され，並列に演算を行う（図 2 参照）。

Tensorコア（図 3）は，ディープニューラルネット(DNN)

の学習や推論で多用される大きな行列の計算に特化された

演算ユニットだ。入力行列は半精度浮動小数点，または 8

ビット固定小数点で，積算結果を単精度浮動小数点，また

は 32 ビット固定小数点で蓄積する。4 × 4 行列同士の内積

を得るには 64 回の積算と 64 回の加算が必要だが，この演

算を 1 サイクルで実行する。より大きな行列も 4 × 4 の行

列で分割することで扱うことが出来る。

Tesla V100（図 4）では，GPU ダイと 4 個の HBM2 メモ

図 4.　Tesla V100

リをシリコンインターポーザ上で配線している。HBM2 メ

モリは，複数のメモリダイがシリコン貫通 VIA (TSV) 技術

を用いてスタックされている（図 5）。GV100 では，合計す

ると 4,096 ビットという広いデータ幅でメモリアクセスが 可能になることでピーク時 900 GB/秒の帯域幅を実現して

メモリアクセスでのボトルネックを大きく低減している。 　GV100 のダイサイズが 815 mm2 で，これは現行の露光装 置で製造できるサイズのほぼ上限に達している。演算能力

をさらにスケールさせるために，マルチ GPU やマルチ GPU/CPU という構成を取ることが可能だ。GV100 は，

図 5.　Chip on Wafer on Substrate 技術を使用した配線

（写真は Tesla P100 のもの）

NVLink という高速インターコネクトを内蔵しており，片 方向 25 GB/秒のリンクを 6 本，合計すると 300 GB/秒とい

う帯域を実現している。これは PCI Express を使用した場合

に比べ約 10 倍になる。さらに NVSwitch（図 6）と呼ばれ

る高速クロスバースイッチを介して 16 基のGPU のNVLink

で完全結合することも可能である。この構成により 0.5 テ

ラバイトの統合メモリ空間と 2 ペタ FLOPS の計算処理能力

を持った 1 つの大型アクセラレータとして使用できる。

図 6.　NVSwitch によるマルチ GPU 構成

Copyright© The Japan Institute of Electronics Packaging

エレクトロニクス実装学会誌　Vol. 23 No. 3 (2020)

205

図 9.　畳み込みの例

図 7.　ILSVRC 分類タスクの正解率

図 10.　全結合の例

込み演算は入力行列と畳み込まれる行列の内積の連続であ

り，GPU で高速化しやすい。CNN のトレーニング時には，

図 8.　AlexNet の構造

畳み込みカーネルの重みとバイアスが調整される。続く全

結合層では，全ての入力を全ての出力に結合し，特徴量に

3. GPU とディープラーニング

基づいた分類を行う（図 10）。全結合の演算は，行列の内

積であり，GPU で並列演算が可能である。トレーニング時

近年ディープラーニング（深層学習）が注目されるよう

に，結合の重みとバイアスが調整される。

になったきっかけの一つが 2012 年の ImageNet Large Scale

Visual Recognition Challenge (ILSVRC) だ。トロント大学の

4. GPU と自動運転

チームが，畳み込みニューラルネットワーク (CNN) を使っ

日本国内では高齢者ドライバの操作ミスによる事故が大

て，前年までの画像分類の記録を一気に 10% 以上向上させ

きく取り上げられ社会問題の一つとなっている。運転免許

た（図 7）。

証の自主返納などの動きがあるが，過疎が進む地域では公

この時に使用されたニューラルネットは Alexnet と呼ば

共の交通手段の利用もままならないことが多く，移動手段

れ，5 つの畳み込み層と 3 つの全結合層で構成されており，

の確保も大きな課題になっている。また，運輸・運送の分

6,000 万個のパラメータと 65 万個のニューロンを持つ（図

野でも特に長時間・長距離を走行する車両のドライバの負

8）。通常，教師あり DNN モデルのトレーニング時には，

担の低減や安全性の確保，ラストワンマイルのサービスに

正解ラベルを付加したデータを大量にモデルに入力し，出

関わる労働力不足を解消し，持続可能なものにするための

力から正解が得られるように畳み込みフィルタや全結合の

手段が必要とされている。

重みやバイアスなどのパラメータの調整を何度も繰り返

4.1	 自動運転用車載コンピュータ

す。120 万枚のデータセットを用いた Alexnet のトレーニン

NVIDIAは，自動運転車両用の車載コンピュータのリファ

グには，GeForce GTX580 GPU が活用された。翌年以降，

レンスデザインである DRIVE AGX（図 12）と，その上で

ほとんどのチームがディープラーニングを採用し，ILSVRC

動作する自動運転用ソフトウェアスタック DRIVE Software

2015 で優勝した ResNet-152 の正解率の 96.4% は，訓練さ

も開発している。

れた人間が分類を行なった場合の正解率 94.9% を超えてい

車載コンピュータ DRIVE AGX の中心となっているの

る。

が，自動運転用に開発された SoC の Xavier（図 11）であ

CNN の畳み込み層では，入力に対してフィルター（カー

ネル）を畳み込んで行き，特徴量を抽出する（図 9）。畳み

る。90 億トランジスタで構成され，12 nm プロセスで製 造，ダイサイズは約 350 mm2 だ。Xavier はメイン CPU と

206

エレクトロニクス実装学会誌　Vol. 23 No. 3 (2020)

Copyright© The Japan Institute of Electronics Packaging

図 11.　Xavier SoC

図 12.　DRIVE AGX Pegasus

して，ARM v8.2 64 ビットアーキテクチャ準拠の CPU を 8

図 13.　認識 DNN の例

基内蔵する。また，内蔵 GPU は 512 個の CUDA コアと 64

個 Tensor コアで構成される。GPU の性能は，CUDA コアが

1.3 TFLOPS，Tensor コアが 20 TOPS である。また典型的な

CNNを処理するためのアクセラレータDLAや，コンピュー

タビジョン用のアクセラレータ PVA も内蔵している。これ

らのアクセラレータで動作させるアルゴリズムは GPU でも

処理可能だが，処理をアクセラレータにオフロードするこ

図 14.　白線が消えた道路での経路推定（首都高 4 号線）

とにより，GPU をより新しく複雑なニューラルネットやア

ルゴリズム処理に使えるように配慮している。

経路計画には 3 つの異なる方法でトレーニングされた

Xavier には，PCIe や NVLInk などの高速インターフェイ

DNN を使用している。路面の白線を検出する LaneNet，白

スも備えており，外部により高性能な GPU を接続し，演算

線にたよらず走行可能な経路端を推定する PathNet，人間の

性能をスケールさせることが可能となっている。

ステアリング操作を教師データとしてトレーニングした

4.2	 自動運転用ソフトウェアスタック

PilotNet の出力から，機械学習のアンサンブル手法を使い

自動運転用ソフトウェアスタック DRIVE Software は，さ

堅牢な経路候補を生成する。それぞれのニューラルネット

まざまな DNN を使用して自車両周囲の環境を認識してい

が誤認識を起こした場合にもその影響を受けにくくなる

る（図 13）。例えば，障害物を認識しその相対位置を推定

（図 14）。

する DNN，連続した画像から周囲の車両の軌道を予測する

また，3 次元高精度地図 (HD-Map) が事前に用意されてい

DNN，車線や道路端を検出する DNN，経路を推定する

る場合は，自己位置推定を行い，地図に埋め込まれた車線

DNN，交差点を検出する DNN，信号機や交通標識，路面

情報を使って経路計画を行うことも出来る。自己位置推定

標示を検出する DNN，セマンセックセグメンテーションに

では，カメラや LIDAR で道路上の白線，信号機や交通標

より走行可能な領域を認識する DNN，カメラによる視界が

識などを認識し，HD-Map のデータとマッチングを行う。

良好かどうかを判別するDNNなどがあり，SoC 内蔵のGPU

このマッチング処理も GPU による高速化が可能だ。

や DLA，SoC に外部接続された GPU などで推論を行なっ

DRIVE Software には，DRIVEWorks と呼ばれるミドル

ている。認識精度や信頼性を高めるためには，異種アルゴ

ウェアがあり，ユーザによる独自アプリケーションの開発

リズムや異種センサを組み合わせた多重化・冗長化が有効

や，機能の追加を容易にしている。DRIVEWorks には自動

な手段のひとつである。DRIVE Software では，複数の DNN

運転で使われるさまざまなアルゴリズムモジュールが含ま

を使い，カメラとレーダー，LIDAR などのセンサーフュー

れているが，殆どが GPU での高速化が行われている。ステ

ジョンも GPU で実現している。

レオカメラを使った距離推定，連続したカメラ画像の特徴

Copyright© The Japan Institute of Electronics Packaging

エレクトロニクス実装学会誌　Vol. 23 No. 3 (2020)

207

図 16.　自動運転での GPU の活用

易に再現でき，実際の車両を使った検証と違い，安全に何

図 15.　HIL シミュレーション

度もそのシーンを繰り返すことができる。各国で検討され

ている自動運転システムの安全性検証を目的とする共通シ

点トラッキングから周囲の物体の形状を復元する Structure

ナリオも取り込むことができるようになるだろう。

From Mortion (SFM)，3D 点群のマッチングに使われる反復

NVIDIA の DRIVE Constellation は，サーバーラックに組

最接近点 (ICP) アルゴリズムなど，さまざまな機能が提供

み込むことが出来るように設計されている。複数の HIL シ

されている。

ミュレーションシステムをサーバルームに設置することに

4.3	 GPU と自動運転システムの検証

よって，システム検証を同時に実行し，検証に必要な時間

自動運転システムの検証にもGPU を活用することが出来

を大幅に短縮することがきる。これは，市場投入時や OTA

る。試験の対象となる実際の ECU を，試験環境に組み込ん

で検証を行うのが，HIL (Hardware-In-the-Loop) シミュレー

(Over-The-Air) などでECU のソフトウェアを更新する場合に も大きなアドバンテージとなる。また，CI/CD (Continuous

ションだ（図 15）。

Integration, Continuous Delivery) を用いた開発プロセスの中

GPU を搭載したコンピュータで動作するシミュレータが

に HILS システムを組み込むことも可能となる。

仮想 3D 空間を構築する。シミュレータには，環境モデル，

交通モデル，センサーモデル，ビークルダイナミクスモデ

5. 最後に

ル，シナリオなどが与えられる。

GPU は，自動運転用 DNN のトレーニング，システム検

シミュレータは，環境モデルに基づいて道路や道路周囲

証，車載コンピュータなど，いろいろな工程で活用するこ

の物体，建物などをモデリングし，交通モデルやシナリオ

とができる（図 16）。多岐の産業にまたがるディープラー

に従い，自車両の周囲に車両や歩行者を配置する。次に，

ニングの発展は目を見張るものがあり，日々新しい方式が

仮想空間内の自車に搭載されたセンサー位置で，センサー

提案され急激な速度で進化を続けている。プログラミング

モデルを使って仮想センサーデータを生成する。生成され

可能な GPU の柔軟性は，それらの新しい手法を速やかに取

たセンサーデータは，車載時と同じハードウェアインター

り込むことが可能なプラットフォームである。GPU の自動

フェイスを用いて ECU にデータを送信する。センサーデー

運転分野でのさらなる活用に期待したい。

タを受けた自動運転 ECU は，実際に車両に搭載された時と

（2020.2.4- 受理）

同じように，認知，判断を行い，操作コマンドを CAN や

・

Ethernet 経由で発行する。操作コマンドは，シミュレータ

文　　　献

に戻され，ビークルダイナミクスを考慮した物理シミュ

1) 馬路　徹：“GPU: AI，スーパコンピューティング，自動運

レーションで次の自車位置が決定される。周囲の車両や歩

転等の基幹プロセッサ，”最先端実装技術シンポジューム，

行者の位置は交通モデルやシナリオに準じて再配置される。

2019 年 6 月

GPU を使ったシミュレータでは，天候，時間帯，路面の

2) https://www.top500.org/

状態，光の反射などさまざまな環境条件下でフォトリアル

3) 成瀬　彰：“Volta And Turing: Architecture and Performance

なカメラ画像をリアルタイムで生成することができる。レ

Optimization，”GTC Japan，2018 年 9 月

ンズの歪みやセンサのカラーフィルタアレイの配列，セン

4) 成瀬　彰：“DGX-2 を中心とした最新 GPU 技術情報，”

サーの特性などを模擬したカメラセンサーモデルが，合成

NVIDIA Deep Learning セミナー，2018 年 4 月

された二次元画像の変換を行う。LiDAR は，レーザー光を

5) http://image-net.org/challenges/LSVRC/

照射し，その散乱や反射光を観測することで対象物までの

6) A. Krizhevsky, I. Sutskever, and G. E. Hinton: “ImageNet

距離を計測するシステムであり，これも GPU でシミュレー ションすることが容易にできる。レーダ，GPS/GNSS，加

classification with deep convolutional neural networks,” NIPS,

2012

速度センサーやジャイロなどもモデリングされ，シミュ

レータに組込まれる。

室河　徹（むろかわ　とおる）

著者紹介

シミュレータは，非常に希にしか起きない交通状況も容

208

エレクトロニクス実装学会誌　Vol. 23 No. 3 (2020)

Copyright© The Japan Institute of Electronics Packaging